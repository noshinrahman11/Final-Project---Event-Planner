<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upcoming Events</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Playfair Display', serif;
        background-image: url('https://www.saturdaygift.com/wp-content/uploads/Cute-aesthetic-calendars-by-SaturdayGift.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        margin: 0;
        padding: 0;
        color: #fff;
    }
    .flash-messages {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 999;
        text-align: center;
    }
    .flash-message {
        padding: 10px;
        margin-bottom: 10px;
        display: inline-block;
        border-radius: 5px;
        width: auto;
    }
    .flash-message.error {
        color: #fff;
        background-color: rgba(255, 0, 0, 0.7);
    }
    .flash-message.success {
        color: #fff;
        background-color: rgba(0, 128, 0, 0.7);
    }
    .container {
        text-align: center;
        background-color: rgba(255, 255, 255, 0.95);
        padding: 50px;
        border-radius: 20px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        width: 90%; /* Adjusted width for better visibility */
        max-width: 600px; /* Added max-width for responsiveness */
        margin: 20px auto; /* Centering the container */
    }
    h1 {
        color: #333;
        margin-bottom: 20px;
    }
    h2 {
        color: #333;
        margin-bottom: 20px;
    }
    .event {
        border-bottom: 1px solid #ccc;
        padding: 20px 0;
    }
    .event:last-child {
        border-bottom: none;
    }
    .event .name {
        font-size: 20px;
        font-weight: bold;
        color: #333;
    }
    .event .time {
        color: #666;
        margin-bottom: 10px;
    }
    .event .description {
        color: #555;
    }
    .button {
        display: inline-block; /* Changed to inline-block */
        margin: 5px; /* Adjusted margin */
        padding: 8px 16px;
        font-size: 14px;
        background-color: #007bff;
        color: #333;
        font-weight: normal;
        font-family: 'Playfair Display', serif;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .button:hover {
        background-color: #0056b3;
    }
    input[type="text"], textarea, input[type="datetime-local"] {
        width: calc(100% - 22px); /* Adjusted width */
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }
    .sorting-buttons .button {
        background-color: #EDDCD8; /* Green */
    }
    .sorting-buttons .button:hover {
        background-color: #BCC3D0; /* Dark green */
    }
    </style>
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
                <div class="flash-message {{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}
</head>
<body>
    
<form class="container" id="form-id" action="/dashboard" method="post" onsubmit="return validateForm()">
    <!-- Sorting buttons -->
    <div class="sorting-buttons">
        <button class="button" id="sortByName">Sort by Name</button>
        <button class="button" id="sortByTime">Sort by Time</button>
    </div>    
    
    <!-- User's Event list-->
    <h1>Upcoming Events</h1>
    <div id="eventsContainer">
        {% for event in events %} <!-- |sort(attribute='time') -->
        <div class="event">
            <div class="name">{{ event.name }}</div>
            <div class="time">Time: {{ event.time }}</div>
            <div class="description">{{ event.description }}</div>


            <!-- <button class="removeEvent" onClick="deleteTask( '{{ event.id }}' )">Remove</button> -->
            
            
            <!-- Button for deleting a task -->
            <!-- <button type="button" class="close" onClick="deleteTask( '{{ event.id }}' )">
                <span aria-hidden="true">&times;</span>
            </button>  -->
        </div>
        {% endfor %}
    </div>

    <!-- Form for adding a new event -->
    <h2>Add New Event</h2>
    <input type="text" id="eventName" name="name" placeholder="Event Name">
    <input type="datetime-local" id="eventTime" name="time" placeholder="Event Time">
    <textarea id="eventDescription" name="description" placeholder="Event Description"></textarea>
    <button id="addEvent" type="submit">Add Event</button>
    <!-- <button id="logout">Logout</button> -->
    <a href="/logout"><button type="button">Logout</button></a>
</form>

    
<!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->

<script>
    // Automatically fade out flash messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            var flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                message.style.transition = 'opacity 0.5s ease';
                message.style.opacity = '0';
                setTimeout(function() {
                    message.remove();
                }, 500);
            });
        }, 5000);
    });

    // Function to sort events by name
    document.getElementById('sortByName').addEventListener('click', function() {
        const eventsContainer = document.getElementById('eventsContainer');
        const events = Array.from(eventsContainer.querySelectorAll('.event'));
        events.sort((a, b) => {
            const nameA = a.querySelector('.name').textContent.toUpperCase();
            const nameB = b.querySelector('.name').textContent.toUpperCase();
            return nameA.localeCompare(nameB);
        });
        events.forEach(event => eventsContainer.appendChild(event));
    });

    // Function to sort events by time (Must reload page for it to work)
    document.getElementById('sortByTime').addEventListener('click', function() {
        const eventsContainer = document.getElementById('eventsContainer');
        const events = Array.from(eventsContainer.querySelectorAll('.event'));
        events.sort((a, b) => {
            const timeA = new Date(a.querySelector('.time').textContent.replace('Time: ', ''));
            const timeB = new Date(b.querySelector('.time').textContent.replace('Time: ', ''));
            return timeA - timeB;
        });
        events.forEach(event => eventsContainer.appendChild(event));
    });

    // Automatically remove past events
    document.addEventListener('DOMContentLoaded', function() {
        const eventsContainer = document.getElementById('eventsContainer');
        const events = Array.from(eventsContainer.querySelectorAll('.event'));
        const currentTime = new Date();

        events.forEach(event => {
            const eventTime = new Date(event.querySelector('.time').textContent.replace('Time: ', ''));
            if (eventTime < currentTime) {
                event.remove(); // Remove the event from the DOM if it's in the past
            }
        });
    });

    // // Function to sort events by time
    // document.getElementById('sortByTime').addEventListener('click', function() {
    //     const eventsContainer = document.getElementById('eventsContainer');
    //     const events = Array.from(eventsContainer.querySelectorAll('.event'));
    //     events.sort((a, b) => {
    //         const timeA = new Date(a.querySelector('.time').textContent);
    //         const timeB = new Date(b.querySelector('.time').textContent);
    //         return timeA - timeB;
    //     });
    //     events.forEach(event => eventsContainer.appendChild(event));
    // });


    // Makes sure that all events with empy fields are not added
    function validateForm() {
        var eventName = document.getElementById('eventName').value;
        var eventTime = document.getElementById('eventTime').value;
        var eventDescription = document.getElementById('eventDescription').value;
        
        if (eventName.trim() === '' || eventTime.trim() === '' || eventDescription.trim() === '') {
            alert('Please fill in all fields.');
            return false; // Prevent form submission
        }
        
        return true; // Allow form submission
    }

    function apiRequest (path,obj) {
        axios.post(path, obj).then(
            (response) => {
                let result = response.data;
                console.log(result);
            },
            (error) => {
                console.log(error);
            }
        );
    }

</script>

<!--
<script>
    // Function to delete an event
    function deleteEvent(eventId) {
        fetch('/delete-event', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ eventId: eventId }),
        })
        .then(response => response.json())
        .then(data => {
            // If the event was deleted successfully, remove it from the DOM
            const eventElement = document.getElementById(`event-${eventId}`);
            if (eventElement) {
                eventElement.remove();
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    // Add event listeners to delete buttons
    document.querySelectorAll('.removeEvent').forEach(button => {
        button.addEventListener('click', () => {
            const eventId = button.dataset.eventId;
            deleteEvent(eventId);
        });
    });
    
    // Logout function (if needed)
    document.getElementById('logout').addEventListener('click', () => {
        // Handle logout logic here
    });
</script> -->


<!-- 
<div class="container">
    <h1>Upcoming Events</h1>
    <div id="eventsContainer"></div>
    <h2>Add New Event</h2>
    <input type="text" id="eventName" placeholder="Event Name">
    <input type="datetime-local" id="eventTime" placeholder="Event Time">
    <textarea id="eventDescription" placeholder="Event Description"></textarea>
    <button id="addEvent" type="submit">Add Event</button>
    <button id="logout">Logout</button>
</div> -->

<!-- Logout button
<div class="container-fluid d-flex justify-content-end">
    <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
</div>
<br> -->

<!-- index.js for delete event function -->
<!-- <script type="text/javascript" src="{{ url_for('static', filename = 'deleteEvent.js') }}"></script> -->

<!-- <script>

// // Array to store event data
// let eventsData = [];

// Function to render events
// function renderEvents() {
//     const eventsContainer = document.getElementById('eventsContainer');
//     eventsContainer.innerHTML = '';
//     eventsData.forEach(eventData => {
//         const eventDiv = document.createElement('div');
//         eventDiv.classList.add('event');
//         eventDiv.innerHTML = `
//             <div class="name">${eventData.name}</div>
//             <div class="time">Time: ${new Date(eventData.time).toLocaleString()}</div>
//             <div class="description">${eventData.description}</div>
//             <button class="removeEvent">Remove</button>
//         `;
//         eventsContainer.appendChild(eventDiv);

//         // Add event listener to the remove button
//         eventDiv.querySelector('.removeEvent').addEventListener('click', function() {
//             eventsData = eventsData.filter(event => event !== eventData);
//             renderEvents();
//         });
//     });
// }

// // Function to add new event
// document.getElementById('addEvent').addEventListener('click', function() {
//     const eventName = document.getElementById('eventName').value;
//     const eventTime = document.getElementById('eventTime').value;
//     const eventDescription = document.getElementById('eventDescription').value;

//     if (eventName && eventTime && eventDescription) {
//         eventsData.push({ name: eventName, time: new Date(eventTime), description: eventDescription });
//         eventsData.sort((a, b) => a.time - b.time); // Sort events by time
//         renderEvents();

//         // Clear input fields after adding event
//         document.getElementById('eventName').value = '';
//         document.getElementById('eventTime').value = '';
//         document.getElementById('eventDescription').value = '';
//     } else {
//         alert('Please fill in all fields.');
//     }
// }); 

// Logout function
// document.getElementById('logout').addEventListener('click', function() {
//     // Simulate logout by clearing user data
//     eventsData = [];
//     // Redirect to root URL
//     window.location.href = '/';
// });

</script> -->


</body>
</html>

